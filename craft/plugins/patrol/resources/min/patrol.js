(function(d,S,ab){function Q(h,f,l){h.addEventListener?h.addEventListener(f,l,!1):h.attachEvent("on"+f,l)}function W(h){if("keypress"==h.type){var f=String.fromCharCode(h.which);h.shiftKey||(f=f.toLowerCase());return f}return aa[h.which]?aa[h.which]:U[h.which]?U[h.which]:String.fromCharCode(h.which).toLowerCase()}function O(h){h=h||{};var f=!1,l;for(l in X){h[l]?f=!0:X[l]=0}f||(v=!1)}function R(x,w,u,t,s,y){var q,n,r=[],p=u.type;if(!Z[x]){return[]}"keyup"==p&&k(x)&&(w=[x]);for(q=0;q<Z[x].length;++q){if(n=Z[x][q],!(!t&&n.seq&&X[n.seq]!=n.level||p!=n.action||("keypress"!=p||u.metaKey||u.ctrlKey)&&w.sort().join(",")!==n.modifiers.sort().join(","))){var l=t&&n.seq==t&&n.level==y;(!t&&n.combo==s||l)&&Z[x].splice(q,1);r.push(n)}}return r}function c(h){var f=[];h.shiftKey&&f.push("shift");h.altKey&&f.push("alt");h.ctrlKey&&f.push("ctrl");h.metaKey&&f.push("meta");return f}function i(h,f,l){Y.stopCallback(f,f.target||f.srcElement,l)||!1!==h(f,l)||(f.preventDefault&&f.preventDefault(),f.stopPropagation&&f.stopPropagation(),f.returnValue=!1,f.cancelBubble=!0)}function e(h){"number"!==typeof h.which&&(h.which=h.keyCode);var f=W(h);f&&("keyup"==h.type&&b===f?b=!1:Y.handleKey(f,c(h),h))}function k(f){return"shift"==f||"ctrl"==f||"alt"==f||"meta"==f}function a(l,h,s,r){function q(f){return function(){v=f;++X[l];clearTimeout(P);P=setTimeout(O,1000)}}function m(f){i(s,f,l);"keyup"!==r&&(b=W(f));setTimeout(O,10)}for(var n=X[l]=0;n<h.length;++n){var p=n+1===h.length?m:q(r||N(h[n+1]).action);M(h[n],p,r,l,n)}}function N(l,h){var r,q,p,n=[];r="+"===l?["+"]:l.split("+");for(p=0;p<r.length;++p){q=r[p],o[q]&&(q=o[q]),h&&"keypress"!=h&&j[q]&&(q=j[q],n.push("shift")),k(q)&&n.push(q)}r=q;p=h;if(!p){if(!V){V={};for(var m in aa){95<m&&112>m||aa.hasOwnProperty(m)&&(V[aa[m]]=m)}}p=V[r]?"keydown":"keypress"}"keypress"==p&&n.length&&(p="keydown");return{key:q,modifiers:n,action:p}}function M(l,h,q,p,n){T[l+":"+q]=h;l=l.replace(/\s+/g," ");var m=l.split(" ");1<m.length?a(l,m,h,q):(q=N(l,q),Z[q.key]=Z[q.key]||[],R(q.key,q.modifiers,{type:q.action},p,l,n),Z[q.key][p?"unshift":"push"]({callback:h,modifiers:q.modifiers,action:q.action,seq:p,level:n,combo:l}))}var aa={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},U={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},j={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},V,Z={},T={},X={},P,b=!1,g=!1,v=!1;for(ab=1;20>ab;++ab){aa[111+ab]="f"+ab}for(ab=0;9>=ab;++ab){aa[ab+96]=ab}Q(S,"keypress",e);Q(S,"keydown",e);Q(S,"keyup",e);var Y={bind:function(h,f,m){h=h instanceof Array?h:[h];for(var l=0;l<h.length;++l){M(h[l],f,m)}return this},unbind:function(h,f){return Y.bind(h,function(){},f)},trigger:function(h,f){if(T[h+":"+f]){T[h+":"+f]({},h)}return this},reset:function(){Z={};T={};return this},stopCallback:function(h,f){return -1<(" "+f.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==f.tagName||"SELECT"==f.tagName||"TEXTAREA"==f.tagName||f.isContentEditable},handleKey:function(l,h,r){var q=R(l,h,r),p;h={};var n=0,m=!1;for(p=0;p<q.length;++p){q[p].seq&&(n=Math.max(n,q[p].level))}for(p=0;p<q.length;++p){q[p].seq?q[p].level==n&&(m=!0,h[q[p].seq]=1,i(q[p].callback,r,q[p].combo)):m||i(q[p].callback,r,q[p].combo)}q="keypress"==r.type&&g;r.type!=v||k(l)||q||O(h);g=m&&"keydown"==r.type}};d.Mousetrap=Y;"function"===typeof define&&define.amd&&define(Y)})(window,document);var Patrol=Patrol||{cpRule:$("#cpRule"),restrictedAreas:$("#restrictedAreas"),cpRuleButton:$("#addCpRule"),requestingIp:$("#requestingIp"),authorizedIps:$("#authorizedIps"),requestingIpButton:$("#addRequestingIp"),hasCpRule:function(){return(Patrol.restrictedAreas.val().indexOf(Patrol.cpRule.val())!==-1)},hasRequestingIp:function(){return(Patrol.authorizedIps.val().indexOf(Patrol.requestingIp.val())!==-1)},addRequestingIp:function(a){if(Patrol.hasRequestingIp()){return}Patrol.authorizedIps.val(Patrol.requestingIp.val()+"\n"+Patrol.authorizedIps.val());Patrol.authorizedIps.focus();Patrol.requestingIpButton.addClass("disabled")},addCpRule:function(a){if(Patrol.hasCpRule()){return}Patrol.restrictedAreas.val(Patrol.cpRule.val()+"\n"+Patrol.restrictedAreas.val());Patrol.restrictedAreas.focus();Patrol.cpRuleButton.addClass("disabled")},enableFormElement:function(a){a.removeClass("disabled")},disableFormElement:function(a){a.addClass("disabled")},addPatrolRedirect:function(){var a=$("#patrolReturn").val();if(typeof a=="string"&&a.length){$("[name=redirect]").val(a)}}};(function(){if(typeof $=="object"||typeof $=="function"){Patrol.addPatrolRedirect();Patrol.requestingIpButton.on("click",function(a){Patrol.addRequestingIp(a);a.preventDefault()});Patrol.cpRuleButton.on("click",function(a){Patrol.addCpRule(a);a.preventDefault()});Patrol.restrictedAreas.on("focus keyup",function(a){if(Patrol.hasCpRule()){Patrol.disableFormElement(Patrol.cpRuleButton)}else{Patrol.enableFormElement(Patrol.cpRuleButton)}});Patrol.authorizedIps.on("focus keyup",function(a){if(Patrol.hasRequestingIp()){Patrol.disableFormElement(Patrol.requestingIpButton)}else{Patrol.enableFormElement(Patrol.requestingIpButton)}});$("#importSettingsButton").on("click",function(b){var a=$("#importSection");if(a.hasClass("hidden")){a.removeClass("hidden");$(this).addClass("disabled")}b.preventDefault()});$("#cancelImportButton").on("click",function(b){var a=$("#importSection");if(!a.hasClass("hidden")){a.addClass("hidden");$("#importSettingsButton").removeClass("disabled")}b.preventDefault()});$("#runImportSettings").on("click",function(a){$("[name=action]").val("patrol/importSettings");$("form").first().attr("enctype","multipart/form-data").submit();a.preventDefault()});Mousetrap.bind(["command+s","ctrl+s"],function(a){$("form").first().submit();return false})}})();